{"version":3,"file":"vuex-persistedstate.js","sources":["../index.js"],"sourcesContent":["import * as shvl from 'shvl';\r\n\r\nexport default function(options, storage, key) {\r\n  options = options || {};\r\n  storage = options.storage || (window && window.localStorage);\r\n  key = options.key || 'vuex';\r\n\r\n  function canWriteStorage(storage) {\r\n    try {\r\n      storage.setItem('@@', 1);\r\n      storage.removeItem('@@');\r\n      return true;\r\n    } catch (e) {}\r\n\r\n    return false;\r\n  }\r\n\r\n  function getState(key, storage, value) {\r\n    try {\r\n      return (value = storage.getItem(key)) && typeof value !== 'undefined'\r\n        ? JSON.parse(value)\r\n        : undefined;\r\n    } catch (err) {}\r\n\r\n    return undefined;\r\n  }\r\n\r\n  function filter() {\r\n    return true;\r\n  }\r\n\r\n  function setState(key, state, storage) {\r\n    return storage.setItem(key, JSON.stringify(state));\r\n  }\r\n\r\n  function reducer(state, paths) {\r\n    return paths.length === 0\r\n      ? state\r\n      : paths.reduce(function(substate, path) {\r\n          return shvl.set(substate, path, shvl.get(state, path));\r\n        }, {});\r\n  }\r\n\r\n  function subscriber(store) {\r\n    return function(handler) {\r\n      return store.subscribe(handler);\r\n    };\r\n  }\r\n\r\n  if (!canWriteStorage(storage)) {\r\n    throw new Error('Invalid storage instance given');\r\n  }\r\n\r\n  return function(store) {\r\n    const savedState = shvl.get(options, 'getState', getState)(key, storage);\r\n\r\n    if (typeof savedState === 'object' && savedState !== null) {\r\n      store.replaceState(options.arrayMerger ? options.arrayMerger(store.state, savedState) : function (store, saved) { return saved });\r\n    }\r\n\r\n    (options.subscriber || subscriber)(store)(function(mutation, state) {\r\n      if ((options.filter || filter)(mutation)) {\r\n        (options.setState || setState)(\r\n          key,\r\n          (options.reducer || reducer)(state, options.paths || []),\r\n          storage\r\n        );\r\n      }\r\n    });\r\n  };\r\n};\r\n"],"names":["options","storage","key","getState","value","getItem","JSON","parse","undefined","err","window","localStorage","setItem","removeItem","e","canWriteStorage","Error","store","const","savedState","shvl.get","replaceState","arrayMerger","state","saved","subscriber","handler","subscribe","mutation","filter","setState","stringify","reducer","paths","length","reduce","substate","path","shvl.set"],"mappings":"qCAEe,SAASA,EAASC,EAASC,GAexC,SAASC,EAASD,EAAKD,EAASG,GAC9B,IACE,OAAQA,EAAQH,EAAQI,QAAQH,UAA0B,IAAVE,EAC5CE,KAAKC,MAAMH,QACXI,QACGC,KA2BX,GA7CAR,GADAD,EAAUA,OACQC,SAAYS,QAAUA,OAAOC,aAC/CT,EAAMF,EAAQE,KAAO,QAErB,SAAyBD,GACvB,IAGE,OAFAA,EAAQW,QAAQ,KAAM,GACtBX,EAAQY,WAAW,OACZ,QACAC,IAET,OAAO,EAmCJC,CAAgBd,GACnB,MAAM,IAAIe,MAAM,kCAGlB,OAAO,SAASC,GACdC,IAAMC,EAAaC,MAASpB,EAAS,WAAYG,EAA9BiB,CAAwClB,EAAKD,GAEtC,iBAAfkB,GAA0C,OAAfA,GACpCF,EAAMI,aAAarB,EAAQsB,YAActB,EAAQsB,YAAYL,EAAMM,MAAOJ,GAAc,SAAUF,EAAOO,GAAS,OAAOA,KAG1HxB,EAAQyB,YAjBX,SAAoBR,GAClB,OAAO,SAASS,GACd,OAAOT,EAAMU,UAAUD,MAeUT,GAAO,SAASW,EAAUL,IACtDvB,EAAQ6B,QAlCjB,WACE,OAAO,IAiC0BD,KAC5B5B,EAAQ8B,UA/Bf,SAAkB5B,EAAKqB,EAAOtB,GAC5B,OAAOA,EAAQW,QAAQV,EAAKI,KAAKyB,UAAUR,MA+BrCrB,GACCF,EAAQgC,SA7BjB,SAAiBT,EAAOU,GACtB,OAAwB,IAAjBA,EAAMC,OACTX,EACAU,EAAME,OAAO,SAASC,EAAUC,GAC9B,OAAOC,MAASF,EAAUC,EAAMjB,MAASG,EAAOc,WAyBnBd,EAAOvB,EAAQiC,WAC5ChC"}